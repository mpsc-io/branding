<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="HooT RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="HooT Atom Feed"><title data-rh="true">One post tagged with &quot;k8s&quot; | HooT</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hoot.mx/blog/tags/k-8-s"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="description" content="Infinitely Scalable Conferencing API &amp; System by MPSC.io"><meta data-rh="true" name="keywords" content="cloud-native conferencing, conference-api, hoot-conferencing"><meta data-rh="true" property="og:title" content="One post tagged with &quot;k8s&quot; | HooT"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/hoot_icon.png"><link data-rh="true" rel="canonical" href="https://hoot.mx/blog/tags/k-8-s"><link data-rh="true" rel="alternate" href="https://hoot.mx/blog/tags/k-8-s" hreflang="en"><link data-rh="true" rel="alternate" href="https://hoot.mx/blog/tags/k-8-s" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d5288c24.css">
<link rel="preload" href="/assets/js/runtime~main.5eeb704e.js" as="script">
<link rel="preload" href="/assets/js/main.f23e5d7b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/hoot_logo.svg" alt="HooT" class="themedImage_ToTc themedImage--light_HNdA navbar-logo"><img src="/img/hoot_logo.svg" alt="HooT" class="themedImage_ToTc themedImage--dark_i4oU navbar-logo"></div></a><a aria-current="page" class="navbar__item navbar__link nav-links navbar__link--active" href="/">Home</a><a class="navbar__item navbar__link nav-links" href="/docs/design">Design</a><a class="navbar__item navbar__link nav-links" href="/api">API</a><a class="navbar__item navbar__link nav-links" href="/docs">How to use</a><a class="navbar__item navbar__link nav-links" href="/docs/category/usage">Usage</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link nav-links">Deployments</a><ul class="dropdown__menu"><li><a href="https://dev.hoot.mx/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Generic-Development<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://speakerbus-internal.hoot.mx/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Corp Deployment 1<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link nav-links navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link nav-links" href="/support-page">Support</a><a href="mailto:info@mpsc.io?subject=%5BHooT%5D%20Access%20Code%20Request&amp;body=I%20am%20interested%20in%20exploring%20the%20HooT%20Conferencing%20App.%20%0A%0A" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link custom-button">Get Access Code</a><a href="mailto:info@mpsc.io?subject=%5BHooT%5D%20Access%20Code%20Request&amp;body=I%20am%20interested%20in%20exploring%20the%20HooT%20Conferencing%20App.%20%0A%0A" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link nav-links mobile">Get Access Code</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/HooT-Warehouse-Automation">Leveraging Kubernetes and Real-Time Collaboration Tools for Streamlined Warehouse Automation - An Exploration of HooT.mx</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/UCAAS-HTML5">HTML5 Powering Next-Generation Collaboration Systems like HooT.mx</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/UseCase-Political-Campaigns">Use-Case Empowering Political Campaigns with HooT.MX</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/coredns-experiments">Our Experiments with CoreDNS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/UseCase-Command-Control">Use-Case Vehicle Fleet Communication using HooT &amp; AI</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;k8s&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/coredns-experiments">Our Experiments with CoreDNS</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-05-03T00:00:00.000Z" itemprop="datePublished">May 3, 2023</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Amar Akshat</span></div><small class="avatar__subtitle" itemprop="description">Sous-chef</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>CoreDNS is the default DNS server for Kubernetes since version 1.11, replacing kube-dns. It is a flexible, extensible DNS server that can also serve as a service discovery mechanism for your Kubernetes cluster. CoreDNS uses a modular architecture with a plugin-based system, which makes it highly customizable to meet various use cases.</p><p>CoreDNS in Kubernetes:</p><p>When you create a Kubernetes cluster, a CoreDNS instance is automatically deployed as a part of the control plane. This CoreDNS instance is responsible for providing name resolution for Kubernetes services, as well as Pods with custom DNS entries.</p><p>CoreDNS reads the Kubernetes API to find out the services and endpoints, allowing it to respond to DNS queries for service names in the form <code>&lt;service_name&gt;.&lt;namespace&gt;.svc.cluster.local</code>. It also provides reverse DNS records and supports DNS-based service discovery.</p><p>Here&#x27;s an ASCII-based diagram that illustrates how CoreDNS interacts with various elements of Kubernetes and the external world:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+       +-------------+       +-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|             |       |             |       |                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  Pod A      +-------&gt;  Service A  +-------&gt;  CoreDNS        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|             |       |             |       | (Kubernetes     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+       +-------------+       |  Plugin)        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            |                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+       +-------------+       |                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|             |       |             |       |                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  Pod B      +-------&gt;  Service B  +-------&gt;                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|             |       |             |       |                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+------+       +-------------+       +--------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |                                         v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+-------+                         +-------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|              |                         |               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  Kubernetes  |                         | External      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  API Server  |                         | DNS Resolver  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|              |                         |               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+                         +---------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this diagram:</p><ul><li><code>Pod A</code> and <code>Pod B</code> represent application pods running within the Kubernetes cluster.</li><li><code>Service A</code> and <code>Service B</code> represent Kubernetes services that provide load balancing and service discovery for the pods.</li><li><code>CoreDNS</code> is the DNS server for the cluster and uses the <code>kubernetes</code> plugin to discover services and endpoints.</li><li><code>Kubernetes API Server</code> is where CoreDNS gets the information about services and endpoints for service discovery.</li><li><code>External DNS Resolver</code> represents an external DNS server (e.g., Google DNS, Cloudflare, etc.) used by CoreDNS to resolve external domains when needed.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="coredns-configuration">CoreDNS Configuration<a class="hash-link" href="#coredns-configuration" title="Direct link to heading">​</a></h2><p>CoreDNS uses a configuration file called <code>Corefile</code> to define its behavior. The <code>Corefile</code> is composed of multiple stanzas, each of which represents a zone or a specific configuration. Each stanza starts with a domain name or a wildcard (*) followed by a series of plugins.</p><p>Here&#x27;s an example <code>Corefile</code> for a simple Kubernetes setup:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.:53 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lameduck 5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes cluster.local in-addr.arpa ip6.arpa {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pods insecure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fallthrough in-addr.arpa ip6.arpa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ttl 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prometheus :9153</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    forward . /etc/resolv.conf {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        max_concurrent 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loadbalance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we define a single zone (.) that listens on port 53. The plugins used are:</p><ol><li><code>errors</code>: Logs error messages.</li><li><code>health</code>: Provides an HTTP health check endpoint.</li><li><code>ready</code>: Provides a readiness check endpoint.</li><li><code>kubernetes</code>: Enables Kubernetes DNS-based service discovery.</li><li><code>prometheus</code>: Exposes metrics for monitoring.</li><li><code>forward</code>: Forwards DNS queries to external resolvers.</li><li><code>cache</code>: Caches DNS responses.</li><li><code>loop</code>: Detects and prevents forwarding loops.</li><li><code>reload</code>: Automatically reloads the Corefile on changes.</li><li><code>loadbalance</code>: Balances queries across multiple backend endpoints.</li></ol><p>Customizing CoreDNS:</p><p>To modify CoreDNS behavior in a Kubernetes cluster, you can edit the ConfigMap associated with the CoreDNS deployment. Here&#x27;s how you can do that:</p><ol><li>Get the current CoreDNS ConfigMap:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get configmap coredns -n kube-system -o yaml &gt; coredns-configmap.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p>Edit the <code>coredns-configmap.yaml</code> file to modify the <code>Corefile</code> as needed.</p></li><li><p>Apply the updated ConfigMap:</p></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f coredns-configmap.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>CoreDNS will automatically reload its configuration. If it doesn&#x27;t, you can restart the CoreDNS Pods to pick up the changes:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl rollout restart -n kube-system deployment/coredns</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By customizing the Corefile and leveraging the wide variety of plugins available, you can tailor CoreDNS to fit the specific needs of your Kubernetes cluster. To learn more about CoreDNS and its plugins, visit the official documentation: <a href="https://coredns.io/manual/toc" target="_blank" rel="noopener noreferrer">https://coredns.io/manual/toc</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="low-hanging-performance-fruits">Low hanging Performance Fruits<a class="hash-link" href="#low-hanging-performance-fruits" title="Direct link to heading">​</a></h2><p>Here are a few simple CoreDNS hacks that can help improve DNS performance in Kubernetes:</p><ol><li><p>Increase cache size and duration:</p><p>The <code>cache</code> plugin in CoreDNS can help reduce the load on the DNS server and improve query response times by caching DNS responses. You can increase the cache size and cache duration to enhance performance:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cache [TTL] [ZONESIZE]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cache 300 5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This configuration caches responses for up to 300 seconds and allows up to 5,000 items in the cache.</p></li><li><p>Utilize load balancing:</p><p>The <code>loadbalance</code> plugin enables round-robin load balancing for A, AAAA, and MX records. This helps distribute the load across different endpoints and improves overall DNS performance.</p><p>Add the <code>loadbalance</code> plugin in the <code>Corefile</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loadbalance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Adjust the number of concurrent requests:</p><p>The <code>forward</code> plugin forwards DNS queries to external resolvers. You can adjust the maximum number of concurrent requests by using the <code>max_concurrent</code> option:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">forward . /etc/resolv.conf {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_concurrent 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Increase the <code>max_concurrent</code> value according to your cluster&#x27;s capabilities and requirements.</p></li><li><p>Configure negative caching:</p><p>Negative caching stores negative responses (NXDOMAIN) temporarily, reducing the number of queries made for non-existent records. The <code>cache</code> plugin can be used for negative caching by specifying the <code>denial</code> option:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    success CAPACITY [TTL]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    denial CAPACITY [TTL]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    success 5000 300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    denial 1000 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This configuration caches successful responses for up to 300 seconds (5,000-item capacity) and negative responses for up to 60 seconds (1,000-item capacity).</p></li><li><p>Enable prefetching:</p><p>The <code>prefetch</code> plugin prefetches popular records before they expire, ensuring the cache is always up to date. This can help reduce the number of cache misses and improve performance:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prefetch [trigger] [eligible] [duration]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prefetch 10 20 1m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This configuration prefetches a record if it is requested at least 10 times before its TTL expires, with a minimum of 20 seconds remaining. Prefetched records have their TTL reset to 1 minute.</p></li></ol><p>Remember that these hacks can provide performance improvements, but you should always test and monitor the changes to ensure they work as expected in your specific environment. Adjust the parameters based on your cluster size, workloads, and requirements.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="corefile">Corefile<a class="hash-link" href="#corefile" title="Direct link to heading">​</a></h2><p>The Corefile is the primary configuration file for CoreDNS. It is a simple, human-readable text file that defines how CoreDNS should behave and which plugins it should use. The Corefile consists of one or more stanzas, each representing a configuration for a specific zone or a set of zones.</p><p>Each stanza starts with a domain name or a wildcard (*), followed by a list of plugins. Each plugin is responsible for a specific functionality or behavior. Plugins are executed in the order they are listed.</p><p>Here&#x27;s a brief overview of a simple Corefile:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">example.com:53 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plugin1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plugin2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we define a zone for <code>example.com</code> and listen on port 53. The plugins <code>plugin1</code> and <code>plugin2</code> are used for this zone.</p><p>Example Use Cases:</p><ol><li><p>Split-horizon DNS:</p><p>Split-horizon DNS is a technique where different DNS records are returned based on the source IP address of the client. This can be useful for serving different records for internal and external clients.</p><p>Corefile configuration:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">internal.example.com:53 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    acl {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allow net 10.0.0.0/8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file /etc/coredns/db.internal.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">external.example.com:53 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    acl {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allow net 0.0.0.0/0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file /etc/coredns/db.external.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this configuration, we define two zones for <code>internal.example.com</code> and <code>external.example.com</code>. The <code>acl</code> plugin is used to filter clients based on their IP addresses. Internal clients from the 10.0.0.0/8 network can only access <code>internal.example.com</code>, while external clients can access <code>external.example.com</code>.</p></li><li><p>Custom DNS server with forwarding and caching:</p><p>In this use case, we create a custom DNS server that caches responses, forwards external queries, and serves some local domains.</p><p>Corefile configuration:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">local.example.com:53 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file /etc/coredns/db.local.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.:53 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache 300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    forward . 8.8.8.8 8.8.4.4 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        max_concurrent 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we define a zone for <code>local.example.com</code> and serve it from a local file. Another zone (.) acts as a catch-all for other queries, caching responses for 300 seconds and forwarding them to Google&#x27;s DNS servers (8.8.8.8 and 8.8.4.4) with a maximum of 1000 concurrent requests.</p></li><li><p>CoreDNS with Prometheus monitoring:</p><p>In this use case, we enable Prometheus monitoring for CoreDNS to collect metrics.</p><p>Corefile configuration:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.:53 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes cluster.local in-addr.arpa ip6.arpa {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pods insecure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fallthrough in-addr.arpa ip6.arpa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prometheus :9153</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    forward . /etc/resolv.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this configuration, we define a zone (.) that listens on port 53. The <code>prometheus</code> plugin is enabled to expose metrics on port 9153.</p></li></ol><p>These are just a few examples of what you can achieve using CoreDNS and its versatile Corefile configuration. The extensive list of available plugins allows for a wide range of use cases and customizations.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/k-8-s">k8s</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/kubernetes">kubernetes</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/coredns">coredns</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.5eeb704e.js"></script>
<script src="/assets/js/main.f23e5d7b.js"></script>
</body>
</html>